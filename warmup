#!/usr/bin/env bash
set -euo pipefail

# ────────────────────────────────────────────────────────────────
# CONFIGURATION
# ────────────────────────────────────────────────────────────────

SANDBOX="$HOME/sandbox"
mkdir -p "$SANDBOX/day1"
cd "$SANDBOX" || exit 1

# ────────────────────────────────────────────────────────────────
# INTRO – MAN PAGES & SELF-RELIANCE
# ────────────────────────────────────────────────────────────────

clear
cat << "EOF"
=============================================
WELCOME TO THE LINUX DAILY WARM-UP
=============================================

Good morning. As you know, AI created Skynet some years ago and humankind had
to ban it. We need to make sure you don't need it to perform. 
It's only allowed for Senior engineers.

We do NOT Google or ask AI for commands.
We use the tools the system gives us.

Prove you can find and read information yourself without exiting the terminal 
while solving the following challenges, and you will get the job. 
Fail, and you're out.
EOF

echo
read -p "Press Enter to accept the challenge and begin..."

clear
cat << "EOF"
Before we throw real tasks at you, two quick tools you must master.
These are how every good engineer finds and understands commands.

1. Finding unknown commands: apropos (or man -k)

   apropos searches the short descriptions of all installed man pages.

   Examples:
     apropos network
     apropos "list contents"

2. Reading man pages: man <command>

   Inside a man page:
   ────────────────────────────────────────────────────────────────
   Key                  Action
   ────────────────────────────────────────────────────────────────
   Space or f           Move forward one full screen
   b                    Move backward one full screen
   j                    Move down one line
   k                    Move up one line
   h                    Move to the left
   l                    Move to the right
   /word                Search forward for 'word'
   ?word                Search backward for 'word'
   n                    Jump to next search match
   N                    Jump to previous search match
   g                    Jump to the very top of the page
   G                    Jump to the very bottom
   ────────────────────────────────────────────────────────────────
EOF

echo
read -p "Press Enter to continue..."

clear
cat << "EOF"
Excellent. You now know:
- How to find almost any command
- How to navigate and quickly extract useful info from man pages

That's already a massive edge over most beginners.

Let's get to real work.
EOF

echo
read -p "Press Enter to start Day 1 of Internship..."

# ────────────────────────────────────────────────────────────────
# DAY 1 – FIRST MORNING AS KUBECRAFT INTERN
# ────────────────────────────────────────────────────────────────

# ────────────────────────────────────────────────────────────────
# Task 1
# ────────────────────────────────────────────────────────────────
clear
cat <<EOF
Task 1/9
─────────

Before you touch anything, find out who you really are
on this system. Use four different commands.

Self-check:
- One command shows just your username.
- One shows who is currently logged in.
- One shows a more detailed view of logged-in users, what they are doing, and CPU usage.
- One shows your user ID, main group, and secondary groups.

When you have run all four commands and understand the differences
between their outputs,
press Enter to continue...
EOF

read -p ""

# ────────────────────────────────────────────────────────────────
# Task 2 – Temporary user
# ────────────────────────────────────────────────────────────────
clear
cat <<EOF
Task 2/9
─────────

Let's start with some Linux gymnastics...

1. Create a temporary user called 'tempuser' (with home dir).
2. Ops! Change its username to 'tmpuser', update its home directory as well.
3. Create a file owned by tmpuser, set it to: owner rw, group r, others nothing. 
(Use octal permissions mode always!).
4. Finally — delete tmpuser completely (including home).

When you have done ALL steps and seen the results,
press Enter...
EOF

read -p ""

# ────────────────────────────────────────────────────────────────
# Task 3 – Persistent user layla
# ────────────────────────────────────────────────────────────────
clear
cat <<EOF
Task 3/9
─────────

Now create another user: 'layla'.
Make sure she has  a home directory and proper bash shell.

Then — create three files inside her home directory with these permissions:

1. secret.txt     →  (only owner rw)
2. report.txt     →  (owner rw, group+others r)
3. script.sh      →  (owner rwx, group+others rx)

Self-check you MUST perform:
- List the files in long format to verify all is correct

Press Enter to continue...
EOF

read -p ""

# ────────────────────────────────────────────────────────────────
# Task 4 – Give layla sudo
# ────────────────────────────────────────────────────────────────
clear
cat <<EOF
Task 4/9
─────────

Layla will need to run privileged commands later this week.
Add her to the sudo (or wheel) group — the correct way."

Self-check:
- Check layla's groups → confirm sudo/wheel is there
- If missing → fix and check again

When layla is in the sudo group,
press Enter...
EOF

read -p ""

# ────────────────────────────────────────────────────────────────
# Task 5 – Read important /etc files
# ────────────────────────────────────────────────────────────────
clear
cat <<EOF
Task 5/9
─────────

Intern!

a) What pretty name does this OS/distribution have?
b) Print the names of the users who have a bash shell assigned (use pipes)
c) What makes the sudo/wheel groups special?


When you are ready, press Enter...
EOF

read -p ""

# ────────────────────────────────────────────────────────────────
# Task 6  - Filesystem Hierarchy & Find
# ────────────────────────────────────────────────────────────────
clear
cat <<EOF
Task 6/9
─────────
Navigate the filesystem like a senior engineer.

1. Find the path to the 'passwd' executable using a command (not guessing).
2. Create this structure in ~/sandbox/day1:
   logs/
   ├── app/
   └── system/
3. Inside logs/app, create 3 empty files: error.log, access.log, debug.log
4. Use ONE command to find all .log files in logs/ and delete them.

When you've completed all steps and verified,
press Enter...
EOF

read -p ""

# ────────────────────────────────────────────────────────────────
# Task 7  - Text Processing & Pipes
# ────────────────────────────────────────────────────────────────
clear
cat <<EOF
Task 7/9
─────────
Text wrangling without leaving the terminal.

First, run this to create test data:
  echo -e "nginx\napache\nnginx\nmysql\napache\nnginx" > ~/sandbox/day1/services.txt

Now:
1. Sort the file and remove duplicates (one pipeline).
2. Count how many lines contain 'nginx'.
3. Show lines that DON'T contain 'nginx'.
4. Replace all 'nginx' with 'openresty' in the output (don't modify file).

When your pipeline-fu is proven,
press Enter...
EOF

read -p ""

# ────────────────────────────────────────────────────────────────
# Task 8  - Process Management
# ────────────────────────────────────────────────────────────────
clear
cat <<EOF
Task 8/9
─────────
Master the running system.

1. Start a sleep process in background: sleep 300 &
2. List ALL running processes on the system (not just yours).
3. Find the PID of your sleep process using pgrep.
4. Politely terminate it (let it clean up).
5. Verify it's gone.

BONUS: Bring a background job to foreground, then send it back.

When processes obey your commands,
press Enter...
EOF

read -p ""

# ────────────────────────────────────────────────────────────────
# Task 9  - Service Management with systemd
# ────────────────────────────────────────────────────────────────
clear
cat <<EOF
Task 9/9
─────────
The final test: control the system itself.

1. Check if the cron service is running (systemctl).
2. View the last 20 log lines for cron (journalctl).
3. Stop the cron service (don't worry, we'll restart it).
4. Check status again — confirm it's stopped.
5. Start it again and verify.

Self-check:
- Service runs at boot? Check with is-enabled.
- What's the difference between stop and disable?

When you've mastered systemd,
press Enter...
EOF

read -p ""

cat <<EOF
═══════════════════════════════════════════════════════════════
     Kubecraft Daily Warm-up – Day 1 COMPLETE
═══════════════════════════════════════════════════════════════

You have proven you can:
✓ Navigate man pages and find commands
✓ Manage users, groups, and permissions
✓ Traverse the filesystem and wrangle text
✓ Control processes and services

Tomorrow: Networking, SSH, and package management.

Rest well, engineer.
EOF
